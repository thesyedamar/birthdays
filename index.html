<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magical Birthday Surprise</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Poppins:wght@300;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #ff75a0;
            --secondary: #fce38a;
            --glass: rgba(255, 255, 255, 0.1);
            --error: #ff4d4d;
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: radial-gradient(circle at center, #2d1b4e 0%, #0c0911 100%);
            font-family: 'Poppins', sans-serif;
            color: white;
            transition: background 3s ease;
        }

        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            pointer-events: none;
        }

        .scene {
            display: none;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: opacity 1s ease;
            pointer-events: auto;
        }

        .scene.active {
            display: flex;
        }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            padding: 2.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            max-width: 450px;
            width: 90%;
        }

        input {
            background: transparent;
            border: none;
            border-bottom: 2px solid var(--primary);
            color: white;
            font-size: 1.5rem;
            text-align: center;
            margin: 1.5rem 0;
            padding: 0.5rem;
            width: 100%;
            outline: none;
            font-family: 'Dancing Script', cursive;
        }

        #error-msg {
            color: var(--error);
            font-size: 0.85rem;
            height: 20px;
            margin-bottom: 10px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        button {
            background: linear-gradient(45deg, var(--primary), #ff9a9e);
            border: none;
            padding: 12px 30px;
            border-radius: 30px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            font-size: 1.1rem;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 4px 15px rgba(255, 117, 160, 0.4);
        }

        button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(255, 117, 160, 0.6);
        }

        h1 {
            font-family: 'Dancing Script', cursive;
            font-size: 3.5rem;
            margin: 0;
            background: linear-gradient(to right, #fff, var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(255, 117, 160, 0.5);
        }

        #music-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
            background: var(--glass);
            border: 1px solid white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: auto;
        }

        .mic-indicator {
            font-size: 0.8rem;
            margin-top: 10px;
            opacity: 0.7;
            color: var(--secondary);
        }

        .wish-btn {
            margin-top: 20px;
            display: none;
        }

        #gift-instruction {
            position: absolute;
            bottom: 20%;
            color: var(--secondary);
            font-weight: 600;
            animation: bounce 2s infinite;
            display: none;
            pointer-events: none;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .coupon {
            border: 2px dashed var(--secondary);
            padding: 20px;
            margin-top: 20px;
            border-radius: 15px;
            background: rgba(252, 227, 138, 0.15);
            text-align: center;
        }

        .credits {
            position: fixed;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.7rem;
            opacity: 0.5;
            z-index: 5;
        }
    </style>
</head>
<body>

    <div id="canvas-container"></div>

    <div class="ui-layer">
        <div id="scene-entry" class="scene active">
            <div class="glass-card">
                <h2 style="font-family: 'Dancing Script'; font-size: 2.5rem; margin-bottom: 0;">Welcome ‚ú®</h2>
                <p>Enter your name to begin the surprise üéÅ</p>
                <input type="text" id="nameInput" placeholder="Enter Full Name" maxlength="25">
                <div id="error-msg">Sorry, this surprise isn't for you.</div>
                <button onclick="startMagic()">Start the Magic ‚ú®</button>
            </div>
        </div>

        <div id="scene-reveal" class="scene">
            <h1 id="bday-text">Happy Birthday</h1>
        </div>

        <div id="scene-wish" class="scene">
            <h2 style="font-family: 'Dancing Script'; font-size: 2.5rem; margin-bottom: 10px;">Make a wish...</h2>
            <p class="mic-indicator" id="micStatus">Try blowing into your mic! üå¨Ô∏è</p>
            <button class="wish-btn" id="blowBtn" onclick="celebrate()">Or Click to Blow üéÇ</button>
        </div>

        <div id="scene-message" class="scene">
            <div class="glass-card" style="max-width: 550px;">
                <p id="finalMessage" style="font-size: 1.2rem; line-height: 1.8; font-style: italic;"></p>
                <button onclick="revealGift()" style="margin-top: 20px;">Open Surprise Gift üéÅ</button>
            </div>
        </div>

        <div id="scene-letter" class="scene">
            <div class="glass-card" style="max-width: 600px; text-align: left;">
                <h3 id="letterGreeting" style="font-family: 'Dancing Script'; font-size: 2rem; color: var(--secondary);">My Dearest Ayesha,</h3>
                <div id="letterBody" style="max-height: 45vh; overflow-y: auto; padding-right: 10px; font-size: 0.95rem; line-height: 1.6;">
                </div>
                <p style="text-align: right; font-family: 'Dancing Script'; font-size: 1.5rem; margin-top: 20px;">With Love, Amar</p>
                <button onclick="location.reload()" style="width: 100%;">Close and Replay ‚ú®</button>
            </div>
        </div>

        <div id="gift-instruction">Click the gift box to open! üéÅ</div>
    </div>

    <div id="music-toggle" onclick="toggleMusic()">üéµ</div>
    <div class="credits">Developed By Amar</div>

    <script>
        let scene, camera, renderer, particles, heartGroup, cakeGroup, galleryGroup, godRay, giftGroup, confetti = [];
        let mouseX = 0, mouseY = 0;
        let isMoving = false, giftReady = false, cakeHover = false;
        let birthdayName = "";
        let relationshipType = "friend";
        let audioCtx, analyser, dataArray, micStream;
        let isBlown = false;

        const MESSAGES = {
            friend: "To a truly wonderful soul, <br><br> You are an incredible friend and a constant source of joy in my life. May your year be as bright and wonderful as your spirit. Happy Birthday, Ayesha! üåü",
            wife: "To my beautiful Wife, <br><br> You are my heart, my world, and my greatest adventure. Every day with you is a gift I cherish. Thank you for being my partner for life. I love you more than words can say. Happy Birthday, My Love! ‚ù§Ô∏èüí´"
        };

        const MEMORIES = [
            { label: "Our First Meeting", color: 0xff75a0 },
            { label: "Endless Laughter", color: 0xfce38a },
            { label: "Pure Joy", color: 0x4d96ff },
            { label: "A Special Night", color: 0x6bc167 },
            { label: "Deep Conversations", color: 0xa075ff }
        ];

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const pointLight = new THREE.PointLight(0xff75a0, 2);
            pointLight.position.set(5, 5, 5);
            scene.add(pointLight);

            createParticles();
            createHearts();
            createCake();
            createGallery();
            createGodRay();
            createGiftBox();

            window.addEventListener('resize', onWindowResize);
            document.addEventListener('mousemove', (e) => {
                mouseX = (e.clientX - window.innerWidth / 2) / 100;
                mouseY = (e.clientY - window.innerHeight / 2) / 100;
            });

            document.addEventListener('mousedown', onDocumentMouseDown);

            animate();
        }

        async function initMic() {
            try {
                micStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const source = audioCtx.createMediaStreamSource(micStream);
                analyser = audioCtx.createAnalyser();
                analyser.fftSize = 256;
                source.connect(analyser);
                dataArray = new Uint8Array(analyser.frequencyBinCount);
                checkBlow();
            } catch (err) {
                document.getElementById('micStatus').innerText = "Mic access disabled. Use the button!";
            }
        }

        function checkBlow() {
            if (isBlown || !analyser) return;
            requestAnimationFrame(checkBlow);
            analyser.getByteFrequencyData(dataArray);
            let sum = 0;
            for (let i = 0; i < dataArray.length; i++) sum += dataArray[i];
            let average = sum / dataArray.length;
            if (average > 60 && document.getElementById('scene-wish').classList.contains('active')) {
                celebrate();
            }
        }

        function createParticles() {
            const geometry = new THREE.BufferGeometry();
            const vertices = [];
            const velocities = [];
            for (let i = 0; i < 2500; i++) {
                vertices.push(Math.random() * 50 - 25, Math.random() * 50 - 25, Math.random() * 50 - 25);
                velocities.push(0, 0, Math.random() * 0.05);
            }
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
            particles = new THREE.Points(geometry, new THREE.PointsMaterial({
                size: 0.04, color: 0xfce38a, transparent: true, opacity: 0.6, blending: THREE.AdditiveBlending
            }));
            particles.userData.velocities = velocities;
            scene.add(particles);
        }

        function createGodRay() {
            const geometry = new THREE.CylinderGeometry(0.1, 5, 20, 32, 1, true);
            const material = new THREE.MeshBasicMaterial({
                color: 0xffffff,
                transparent: true,
                opacity: 0,
                blending: THREE.AdditiveBlending,
                side: THREE.DoubleSide
            });
            godRay = new THREE.Mesh(geometry, material);
            godRay.position.set(0, 10, -2);
            godRay.rotation.x = Math.PI / 8;
            scene.add(godRay);
        }

        function createGiftBox() {
            giftGroup = new THREE.Group();
            const boxGeom = new THREE.BoxGeometry(2, 2, 2);
            const boxMat = new THREE.MeshPhongMaterial({ color: 0xff75a0 });
            const box = new THREE.Mesh(boxGeom, boxMat);
            box.name = "boxBody";

            const lidGeom = new THREE.BoxGeometry(2.2, 0.5, 2.2);
            const lidMat = new THREE.MeshPhongMaterial({ color: 0xff4d6d });
            const lid = new THREE.Mesh(lidGeom, lidMat);
            lid.position.y = 1.2;
            lid.name = "boxLid";

            const ribbonGeom = new THREE.BoxGeometry(0.2, 2.1, 2.1);
            const ribbonMat = new THREE.MeshPhongMaterial({ color: 0xfce38a });
            const r1 = new THREE.Mesh(ribbonGeom, ribbonMat);
            const r2 = r1.clone();
            r2.rotation.y = Math.PI / 2;
            
            giftGroup.add(box, lid, r1, r2);
            giftGroup.position.y = -10;
            giftGroup.scale.setScalar(0.7);
            scene.add(giftGroup);
        }

        function createGallery() {
            galleryGroup = new THREE.Group();
            MEMORIES.forEach((mem, i) => {
                const group = new THREE.Group();
                const frameGeom = new THREE.PlaneGeometry(1.2, 1.5);
                const frameMat = new THREE.MeshPhongMaterial({ color: 0xffffff });
                const frame = new THREE.Mesh(frameGeom, frameMat);
                
                const photoGeom = new THREE.PlaneGeometry(1, 1);
                const photoMat = new THREE.MeshPhongMaterial({ color: mem.color });
                const photo = new THREE.Mesh(photoGeom, photoMat);
                photo.position.y = 0.15;
                photo.position.z = 0.01;

                group.add(frame, photo);
                
                const angle = (i / MEMORIES.length) * Math.PI * 2;
                group.position.set(Math.cos(angle) * 4, 1, Math.sin(angle) * 4);
                group.lookAt(0, 1, 0);
                group.scale.set(0, 0, 0);
                group.userData.offset = Math.random() * Math.PI * 2;
                galleryGroup.add(group);
            });
            scene.add(galleryGroup);
        }

        function createHearts() {
            heartGroup = new THREE.Group();
            const heartShape = new THREE.Shape();
            const x = 0, y = 0;
            heartShape.moveTo(x + 5, y + 5);
            heartShape.bezierCurveTo(x + 5, y + 5, x + 4, y, x, y);
            heartShape.bezierCurveTo(x - 6, y, x - 6, y + 7, x - 6, y + 7);
            heartShape.bezierCurveTo(x - 6, y + 11, x - 3, y + 15.4, x + 5, y + 19);
            heartShape.bezierCurveTo(x + 12, y + 15.4, x + 16, y + 11, x + 16, y + 7);
            heartShape.bezierCurveTo(x + 16, y + 7, x + 16, y, x + 10, y);
            heartShape.bezierCurveTo(x + 7, y, x + 5, y + 5, x + 5, y + 5);

            const geometry = new THREE.ExtrudeGeometry(heartShape, { depth: 2, bevelEnabled: true, bevelSegments: 2, steps: 2, bevelSize: 1, bevelThickness: 1 });
            geometry.scale(0.02, 0.02, 0.02);
            geometry.rotateZ(Math.PI);

            for (let i = 0; i < 40; i++) {
                const mesh = new THREE.Mesh(geometry, new THREE.MeshPhongMaterial({ color: 0xff4d6d, shininess: 100 }));
                mesh.position.set(Math.random() * 30 - 15, Math.random() * 30 - 15, Math.random() * 15 - 20);
                heartGroup.add(mesh);
            }
            scene.add(heartGroup);
        }

        function createCake() {
            cakeGroup = new THREE.Group();
            const bottom = new THREE.Mesh(new THREE.CylinderGeometry(1.2, 1.2, 0.9, 32), new THREE.MeshPhongMaterial({ color: 0xfff0f3 }));
            const mid = new THREE.Mesh(new THREE.CylinderGeometry(0.8, 0.8, 0.7, 32), new THREE.MeshPhongMaterial({ color: 0xff75a0 }));
            mid.position.y = 0.8;
            const candle = new THREE.Mesh(new THREE.CylinderGeometry(0.05, 0.05, 0.5, 12), new THREE.MeshPhongMaterial({ color: 0xfce38a }));
            candle.position.y = 1.3;
            const flame = new THREE.Mesh(new THREE.SphereGeometry(0.07, 8, 8), new THREE.MeshBasicMaterial({ color: 0xffaa00 }));
            flame.position.y = 1.6;
            flame.name = "flame";
            cakeGroup.add(bottom, mid, candle, flame);
            cakeGroup.position.y = -10;
            scene.add(cakeGroup);
        }

        function animate() {
            requestAnimationFrame(animate);
            
            // Starfield Warp Logic
            if (isMoving) {
                particles.material.size = 0.12;
                particles.rotation.y += 0.05;
            } else {
                particles.material.size = 0.04;
                particles.rotation.y += 0.0008;
            }

            heartGroup.children.forEach(h => {
                h.position.y += (relationshipType === 'wife' ? 0.02 : 0.01);
                h.rotation.y += 0.02;
                if (h.position.y > 15) h.position.y = -15;
            });

            if (cakeGroup && cakeHover) {
                cakeGroup.position.y = -0.5 + Math.sin(Date.now() * 0.002) * 0.1;
                cakeGroup.rotation.y += 0.005;
                const flame = cakeGroup.getObjectByName("flame");
                if (flame) flame.scale.setScalar(1 + Math.sin(Date.now() * 0.01) * 0.25);
            }

            if (galleryGroup) {
                galleryGroup.rotation.y += 0.002;
                galleryGroup.children.forEach((item, idx) => {
                    // Floating effect for each polaroid
                    item.position.y = 1 + Math.sin(Date.now() * 0.001 + item.userData.offset) * 0.3;
                    item.rotation.z = Math.sin(Date.now() * 0.0005 + idx) * 0.1;
                });
            }

            if (giftGroup) {
                giftGroup.rotation.y += 0.01;
                if (giftReady) {
                    giftGroup.position.y = 0.5 + Math.sin(Date.now() * 0.002) * 0.1;
                }
            }

            if (godRay && godRay.material.opacity > 0) {
                godRay.rotation.y += 0.005;
            }

            confetti.forEach((p, i) => {
                p.position.add(p.velocity);
                p.velocity.y -= 0.005;
                p.rotation.x += 0.1;
                if (p.position.y < -5) { scene.remove(p); confetti.splice(i, 1); }
            });

            if (!isMoving) {
                camera.position.x += (mouseX - camera.position.x) * 0.05;
                camera.position.y += (-mouseY - camera.position.y) * 0.05;
                camera.lookAt(scene.position);
            }
            renderer.render(scene, camera);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function startMagic() {
            const input = document.getElementById('nameInput');
            const error = document.getElementById('error-msg');
            const normalized = input.value.trim().toLowerCase();

            if (normalized === "ayesha murtaza") { 
                relationshipType = "friend"; 
                birthdayName = "Ayesha Murtaza"; 
                setupLetterContent("friend");
            }
            else if (normalized === "ayesha amar") { 
                relationshipType = "wife"; 
                birthdayName = "Ayesha My Wife";
                scene.add(new THREE.PointLight(0xff0000, 1.5, 10)); 
                setupLetterContent("wife");
            }
            else { error.style.opacity = "1"; return; }

            error.style.opacity = "0";
            initMic();
            
            document.getElementById('bday-text').innerHTML = `Happy Birthday,<br>${birthdayName} üíñ`;
            document.getElementById('finalMessage').innerHTML = MESSAGES[relationshipType];

            switchScene('scene-entry', 'scene-reveal');
            
            isMoving = true;
            // Cinematic zoom transition
            gsap.to(camera.position, { z: -10, duration: 3, ease: "power4.in", onComplete: () => {
                camera.position.z = 20;
                gsap.to(camera.position, { z: 5, duration: 2, ease: "power2.out" });
                isMoving = false;
                showCake();
            }});
        }

        function setupLetterContent(role) {
            const greeting = document.getElementById('letterGreeting');
            const body = document.getElementById('letterBody');

            if (role === "wife") {
                greeting.innerText = "To My Beautiful Wife, Ayesha,";
                body.innerHTML = `
                    <p>On this beautiful day, I wanted to create something as special as you are. This virtual world is just a small reflection of the joy you bring into our home every single day.</p>
                    <p>Watching you grow and achieve so much as my partner makes me incredibly proud. You have a heart of gold and a smile that can light up the darkest room. Thank you for being my everything.</p>
                    <p>As a small promise of the many beautiful years yet to come, I present this to you:</p>
                    <div class="coupon">
                        <strong style="color: var(--secondary); font-size: 1.1rem; letter-spacing: 1px;">üåπ AN ETERNITY OF US üåπ</strong><br>
                        <p style="font-style: italic; margin-top: 10px;">"Valid for a lifetime of late-night laughs, a thousand dinner dates at your favorite spots, and a heart that will always choose you first."</p>
                        <small style="color: var(--secondary); opacity: 0.8;">‚Äî Redeemable with a single hug ‚Äî</small>
                    </div>`;
            } else {
                greeting.innerText = "Dear Ayesha,";
                body.innerHTML = `
                    <p>I wanted to celebrate this special day by creating something unique just for you. Happy Birthday to an amazing friend!</p>
                    <p>I am constantly inspired by your kindness and the way you care for everyone around you. You deserve all the happiness in the world today and always.</p>
                    <p>Here's a special token for the many chapters yet to come:</p>
                    <div class="coupon">
                        <strong style="color: var(--secondary); font-size: 1.1rem; letter-spacing: 1px;">‚ú® THE ETERNAL FRIENDSHIP PACT ‚ú®</strong><br>
                        <div style="font-style: italic; margin-top: 10px; line-height: 1.8;">
                            A hand to hold through thick and thin,<br>
                            A place where laughter always begins.<br>
                            Coffee dates and plans on whim,<br>
                            A light that never shall grow dim.<br>
                            Just a call away for your next quest,<br>
                            In this bond, we are truly blessed.
                        </div>
                        <small style="color: var(--secondary); opacity: 0.8; display: block; margin-top: 10px;">‚Äî Forever Valid & Non-Expiring ‚Äî</small>
                    </div>`;
            }
        }

        function showCake() {
            if (relationshipType === 'wife') {
                document.body.style.background = "radial-gradient(circle at center, #8a2e2e 0%, #2d0b0b 100%)";
            }
            
            gsap.to(cakeGroup.position, { y: -0.5, duration: 2, delay: 0.5, ease: "back.out(1.2)", onComplete: () => {
                cakeHover = true;
            }});
            gsap.to(godRay.material, { opacity: 0.15, duration: 3, delay: 1 });

            galleryGroup.children.forEach((item, i) => {
                gsap.to(item.scale, { x: 1, y: 1, z: 1, duration: 1.5, delay: 1.5 + (i * 0.25), ease: "elastic.out(1, 0.5)" });
            });
            setTimeout(() => {
                switchScene('scene-reveal', 'scene-wish');
                document.getElementById('blowBtn').style.display = 'block';
            }, 5500);
        }

        function celebrate() {
            if (isBlown) return;
            isBlown = true;
            document.getElementById('scene-wish').classList.remove('active');
            gsap.to(cakeGroup.getObjectByName("flame").scale, { x: 0, y: 0, z: 0, duration: 0.5 });
            gsap.to(galleryGroup.scale, { x: 0, y: 0, z: 0, duration: 1 });
            gsap.to(godRay.material, { opacity: 0, duration: 1 });
            
            triggerConfetti();
            gsap.to(camera.position, { x: "+=0.2", duration: 0.1, repeat: 7, yoyo: true });
            setTimeout(() => { 
                switchScene('', 'scene-message'); 
                gsap.to(cakeGroup.position, { y: -10, duration: 2 }); 
                cakeHover = false;
            }, 2000);
        }

        function revealGift() {
            switchScene('scene-message', '');
            gsap.to(giftGroup.position, { y: 0.5, duration: 2, ease: "back.out(1.5)", onComplete: () => {
                giftReady = true;
                document.getElementById('gift-instruction').style.display = 'block';
            }});
        }

        function onDocumentMouseDown(event) {
            if (!giftReady) return;
            const raycaster = new THREE.Raycaster();
            const mouse = new THREE.Vector2((event.clientX / window.innerWidth) * 2 - 1, -(event.clientY / window.innerHeight) * 2 + 1);
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(giftGroup.children);
            if (intersects.length > 0) openGift();
        }

        function openGift() {
            giftReady = false;
            document.getElementById('gift-instruction').style.display = 'none';
            const lid = giftGroup.getObjectByName("boxLid");
            gsap.to(lid.position, { y: 5, duration: 1.5, ease: "power2.out" });
            gsap.to(lid.rotation, { x: 2, z: 1, duration: 1.5 });
            gsap.to(giftGroup.scale, { x: 0, y: 0, z: 0, delay: 0.8, duration: 1, onComplete: () => {
                switchScene('', 'scene-letter');
            }});
            triggerConfetti();
        }

        function triggerConfetti() {
            const colors = relationshipType === 'wife' ? [0xff0000, 0xff75a0, 0xffffff] : [0xff75a0, 0xfce38a, 0x4d96ff, 0x6bc167];
            for (let i = 0; i < 200; i++) {
                const p = new THREE.Mesh(new THREE.PlaneGeometry(0.12, 0.12), new THREE.MeshBasicMaterial({ color: colors[Math.floor(Math.random() * colors.length)], side: THREE.DoubleSide }));
                p.position.set(0, 0, 0);
                p.velocity = new THREE.Vector3((Math.random() - 0.5) * 0.4, Math.random() * 0.4 + 0.2, (Math.random() - 0.5) * 0.4);
                confetti.push(p);
                scene.add(p);
            }
        }

        function switchScene(oldId, newId) {
            if (oldId) document.getElementById(oldId).classList.remove('active');
            if (newId) document.getElementById(newId).classList.add('active');
        }

        function toggleMusic() {
            const btn = document.getElementById('music-toggle');
            btn.innerHTML = btn.innerHTML === 'üéµ' ? 'üîá' : 'üéµ';
        }

        window.onload = init;
    </script>
</body>
</html>